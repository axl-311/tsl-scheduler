<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Time & Space Limited — Calendar</title>

<style>
  :root{
    --tsl-black:#000;
    --tsl-white:#fff;
    --tsl-gray-900:#1a1a1a;
    --tsl-gray-700:#4a4a4a;
    --tsl-gray-600:#666;
    --tsl-gray-200:#e6e6e6;
    --tsl-gray-100:#f5f5f5;
    --tsl-red:#c4281f;
  }

  *{ box-sizing:border-box; margin:0; padding:0; }

  html, body{
    height:100%;
    background: var(--tsl-white);
    color: var(--tsl-gray-900);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
    line-height:1.35;
    letter-spacing:0;
  }

  .calendar-wrap{
    max-width:1200px;
    margin:0 auto;
    padding:48px 20px 56px;
    min-height:100vh;
  }

  .tsl-header{
    border-bottom:1px solid var(--tsl-black);
    padding-bottom:20px;
    margin-bottom:28px;
  }
  .brand{
    display:flex; align-items:baseline; gap:12px; margin-bottom:12px;
  }
  .brand h1{
    font-size:clamp(22px, 2.6vw, 28px); font-weight:500; letter-spacing:0; color:var(--tsl-black);
  }
  .status{
    font-size:10px; text-transform:uppercase; letter-spacing:.06em;
    color:var(--tsl-black); border:1px solid var(--tsl-black);
    padding:3px 6px; border-radius:3px; font-weight:400;
  }

  .topbar{
    display:grid;
    grid-template-columns: 1fr auto auto;
    gap:16px;
    align-items:center;
  }
  .month-display{
    font-size:clamp(16px, 2.2vw, 18px); font-weight:500;
  }

  .controls{
    display:flex; align-items:center; gap:10px;
  }

  .view-toggle{
    display:flex; gap:0; border:1px solid var(--tsl-black); border-radius:6px; overflow:hidden;
  }
  .view-btn{
    appearance:none; border:none; background:var(--tsl-white); color:var(--tsl-black);
    font:500 12px/1 "Helvetica Neue", Helvetica, Arial, sans-serif;
    padding:8px 12px; cursor:pointer; transition:opacity .18s ease;
  }
  .view-btn + .view-btn{ border-left:1px solid var(--tsl-black); }
  .view-btn:hover{ opacity:.6; }
  .view-btn.active{ background:var(--tsl-red); color:var(--tsl-white); }

  .nav-btn{
    appearance:none; background:var(--tsl-white);
    border:1px solid var(--tsl-black); color:var(--tsl-black);
    font:500 12px/1 "Helvetica Neue", Helvetica, Arial, sans-serif;
    padding:8px 12px; border-radius:6px; cursor:pointer; transition:opacity .18s ease;
  }
  .nav-btn:hover{ opacity:.6; }

  .legend{
    display:flex; gap:clamp(12px, 2vw, 20px); flex-wrap:wrap; justify-self:end;
  }
  .legend-item{
    display:flex; align-items:center; gap:8px; font-size:clamp(13px, 1.8vw, 16px); color:var(--tsl-black); font-weight:400;
  }
  .legend-swatch{
    width:10px; height:10px; border:1px solid var(--tsl-black); background:var(--tsl-white);
  }
  .swatch-events{ background:var(--tsl-red); }
  .swatch-movies{ background:var(--tsl-white); }

  .calendar-grid{
    display:grid; grid-template-columns:repeat(7, 1fr);
    gap:0; border:1px solid var(--tsl-black); border-radius:8px; overflow:hidden;
    margin-top:20px; margin-bottom:40px;
  }
  .day-header{
    font:500 clamp(10px, 1.5vw, 11px)/1 "Helvetica Neue", Helvetica, Arial, sans-serif;
    letter-spacing:.08em; text-transform:uppercase; color:var(--tsl-black);
    padding:12px 8px; text-align:center; background:var(--tsl-gray-100);
    border-right:1px solid var(--tsl-black);
  }
  .day-header:last-child{ border-right:none; }

  .day-cell{
    position:relative; min-height:120px; padding:clamp(8px, 1.2vw, 10px) clamp(6px, 1vw, 8px); background:var(--tsl-white);
    border-top:1px solid var(--tsl-black); border-right:1px solid var(--tsl-black);
    display:flex; flex-direction:column; gap:6px;
  }
  .other-month{ background:#fafafa; color:#bbb; }
  .day-number{
    font:500 clamp(11px, 1.7vw, 12px)/1 "Helvetica Neue", Helvetica, Arial, sans-serif; color:var(--tsl-black); margin-bottom:4px;
  }
  .today{
    outline:2px solid var(--tsl-red);
    outline-offset:-2px;
    background:#fff8f7;
  }

  .event{
    display:block; text-decoration:none; color:var(--tsl-black);
    background:var(--tsl-white);
    border:1px solid var(--tsl-black);
    padding:clamp(5px, 1vw, 6px) clamp(6px, 1vw, 8px); border-radius:6px;
    font:500 clamp(10px, 1.6vw, 11px)/1.25 "Helvetica Neue", Helvetica, Arial, sans-serif;
    transition:opacity .18s ease;
  }
  .event:hover{ opacity:.6; }
  .event-time{ font:400 clamp(9px, 1.4vw, 10px)/1.2 "Helvetica Neue", Helvetica, Arial, sans-serif; color:var(--tsl-gray-700); margin-top:3px; }

  .event.special-events{ border-left:3px solid var(--tsl-red); }
  .event.movies{ border-left:3px solid var(--tsl-black); }

  .calendar-grid.week-view{
    border:none; gap:clamp(8px, 1.5vw, 12px); grid-template-columns:repeat(7, 1fr);
  }
  .calendar-grid.week-view .day-header{ display:none; }
  .calendar-grid.week-view .day-cell{
    border:1px solid var(--tsl-black); border-radius:10px; min-height:clamp(220px, 45vw, 360px); padding:clamp(12px, 2vw, 14px) clamp(10px, 1.8vw, 12px);
  }
  .calendar-grid.week-view .day-cell .day-header-inline{
    background:var(--tsl-gray-100); border:1px solid var(--tsl-black);
    padding:clamp(8px, 1.6vw, 10px) clamp(6px, 1.2vw, 8px); border-radius:8px; margin-bottom:clamp(8px, 1.6vw, 12px);
    font:500 clamp(11px, 1.7vw, 12px)/1 "Helvetica Neue", Helvetica, Arial, sans-serif; text-transform:uppercase; letter-spacing:.06em;
  }

  .loading{
    display:flex; align-items:center; justify-content:center; min-height:320px;
    color:var(--tsl-gray-700); font-size:14px;
  }
  .error{
    background:#fff2f2; border:1px solid #ffd2d2; color:#b40000;
    padding:14px; border-radius:8px; font-size:14px;
  }

  .footer{
    border-top:1px solid var(--tsl-black);
    padding-top:18px; text-align:center; color:var(--tsl-gray-700); font-size:clamp(11px, 1.6vw, 12px);
  }

  @media (prefers-reduced-motion: reduce){
    .event, .view-btn, .nav-btn{ transition:none; }
  }

  @media (max-width: 900px){
    .topbar{ grid-template-columns: 1fr; gap:12px; }
    .legend{ justify-content:flex-start; }
  }
  @media (max-width: 720px){
    .calendar-wrap{ padding:28px 14px 36px; }
    .brand h1{ font-size:clamp(20px, 5vw, 22px); }
    .month-display{ font-size:clamp(15px, 4.5vw, 16px); }
    .day-header{ font-size:clamp(10px, 3.3vw, 12px); padding:10px 6px; }
    .day-cell{ min-height:90px; }
    .event{ font-size:clamp(10px, 3.2vw, 12px); }
    .event-time{ font-size:clamp(9px, 2.8vw, 11px); }
    .calendar-grid.week-view{ grid-template-columns:1fr; }
  }
</style>
</head>
<body>
  <div class="calendar-wrap">
    <header class="tsl-header" aria-label="Calendar Header">
      <div class="brand">
        <h1>Time & Space Limited — Calendar</h1>
        <span class="status">Live</span>
      </div>

      <div class="topbar">
        <div class="month-display" id="monthDisplay" aria-live="polite">Loading…</div>

        <div class="controls" role="group" aria-label="Change View">
          <div class="view-toggle" aria-label="View Toggle">
            <button class="view-btn active" id="monthViewBtn" aria-pressed="true">Month</button>
            <button class="view-btn" id="weekViewBtn" aria-pressed="false">Week</button>
          </div>
          <button class="nav-btn" id="prevBtn" aria-label="Previous">← Previous</button>
          <button class="nav-btn" id="todayBtn" aria-label="Today">Today</button>
          <button class="nav-btn" id="nextBtn" aria-label="Next">Next →</button>
        </div>

        <div class="legend" aria-label="Legend">
          <div class="legend-item"><span class="legend-swatch swatch-events"></span> Special Events</div>
          <div class="legend-item"><span class="legend-swatch swatch-movies"></span> Movies</div>
        </div>
      </div>
    </header>

    <div id="loadingMessage" class="loading">Initializing calendar…</div>

    <div class="calendar-grid" id="calendarGrid" style="display:none;">
      <div class="day-header">Mon</div>
      <div class="day-header">Tue</div>
      <div class="day-header">Wed</div>
      <div class="day-header">Thu</div>
      <div class="day-header">Fri</div>
      <div class="day-header">Sat</div>
      <div class="day-header">Sun</div>
    </div>

    <footer class="footer">
      Updated from Google Calendar (ET). Links open in a new tab.
    </footer>
  </div>

  <script>
    const CLIENT_ID = '805806936738-svig4rs4b96t849n81b7e5hi8p44qo0v.apps.googleusercontent.com';
    const API_KEY = 'AIzaSyDzisAik43Rr1xTJXg2bHXNF_XRTjjZsh8';
    const DISCOVERY_DOCS = ['https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest'];
    const SCOPES = 'https://www.googleapis.com/auth/calendar.readonly https://www.googleapis.com/auth/calendar.events';

    const CALENDARS = {
      '1ed95b09dcc5ea1a1e13267b6654eca3c892fc79c23e2e9edc1e271411967255@group.calendar.google.com': { name:'Special Events', class:'special-events' },
      '007f10222d517076d028161a4cda7108e75444c18ef7ac0d79aee420313d1a7b@group.calendar.google.com': { name:'Movies', class:'movies' },
      'ed801a88ce91b43543ef4e87c34d1405a6e053c5254e55e2871f0d305ecc32c4@group.calendar.google.com': { name:'Movies', class:'movies' }
    };

    let gapi;
    let currentDate = new Date();
    let currentView = 'month';

    async function initializeGapi(){
      try{
        await new Promise((res, rej)=>{
          const s=document.createElement('script');
          s.src='https://apis.google.com/js/api.js';
          s.onload=res; s.onerror=rej; document.head.appendChild(s);
        });
        gapi = window.gapi;
        await new Promise((res)=> gapi.load('client', res));
        await gapi.client.init({ apiKey: API_KEY, discoveryDocs: DISCOVERY_DOCS });
        document.getElementById('loadingMessage').textContent='Loading events…';
        await loadCalendar();
      }catch(err){
        console.error(err);
        showError('Failed to initialize Google Calendar. Check connection and refresh.');
      }
    }

    function showError(msg){
      const el=document.getElementById('loadingMessage');
      el.innerHTML = '<div class="error">'+msg+'</div>';
    }

    function startEndForView(){
      let startDate, endDate;
      if(currentView==='week'){
        const today = new Date(currentDate);
        const dow = today.getDay();
        const mondayOffset = (dow===0 ? -6 : 1 - dow);
        startDate = new Date(today); startDate.setDate(today.getDate()+mondayOffset);
        endDate   = new Date(startDate); endDate.setDate(startDate.getDate()+6);
      }else{
        const som = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
        const eom = new Date(currentDate.getFullYear(), currentDate.getMonth()+1, 0);
        startDate = new Date(som);
        const sd = som.getDay(); const subtract = (sd===0 ? 6 : sd-1);
        startDate.setDate(startDate.getDate()-subtract);
        endDate = new Date(eom);
        const ed = eom.getDay(); const add = (ed===0 ? 0 : 7-ed);
        endDate.setDate(endDate.getDate()+add);
      }
      return {startDate, endDate};
    }

    async function loadCalendar(){
      try{
        const {startDate, endDate} = startEndForView();
        const all = [];
        let ok=0;

        for(const [calendarId, cfg] of Object.entries(CALENDARS)){
          try{
            const resp = await gapi.client.calendar.events.list({
              calendarId, timeMin: startDate.toISOString(), timeMax: endDate.toISOString(),
              singleEvents:true, orderBy:'startTime', maxResults:250
            });
            (resp.result.items||[]).forEach(ev=>{
              all.push({...ev, calendarType: cfg.class, calendarName: cfg.name});
            });
            ok++;
          }catch(e){
            console.warn('Calendar failed', cfg.name, e);
          }
        }

        if(ok===0){
          showError('No calendars could be loaded. Verify public access and IDs.');
          return;
        }

        renderCalendar(startDate, endDate, all);
        updateMonthDisplay();
        document.getElementById('loadingMessage').style.display='none';
        document.getElementById('calendarGrid').style.display='grid';
      }catch(e){
        console.error(e);
        showError('Error loading events. Try refreshing.');
      }
    }

    function updateMonthDisplay(){
      const md=document.getElementById('monthDisplay');
      if(currentView==='week'){
        const today=new Date(currentDate);
        const dow=today.getDay();
        const mondayOffset=(dow===0 ? -6 : 1-dow);
        const start=new Date(today); start.setDate(today.getDate()+mondayOffset);
        const end=new Date(start); end.setDate(start.getDate()+6);
        const st=start.toLocaleDateString('en-US',{month:'short', day:'numeric'});
        const en=end.toLocaleDateString('en-US',{month:'short', day:'numeric', year:'numeric'});
        md.textContent = `${st} – ${en}`;
      }else{
        md.textContent = currentDate.toLocaleDateString('en-US',{month:'long', year:'numeric'});
      }
    }

    function renderCalendar(startDate, endDate, events){
      const grid = document.getElementById('calendarGrid');
      grid.classList.toggle('week-view', currentView==='week');
      grid.querySelectorAll('.day-cell').forEach(n=>n.remove());

      const curMonth = currentDate.getMonth();
      const loopDate = new Date(startDate);
      const today = new Date(); today.setHours(0,0,0,0);
      let colIndex = 0;

      while(loopDate<=endDate){
        const cell = document.createElement('div');
        cell.className = 'day-cell';
        const cmp = new Date(loopDate); cmp.setHours(0,0,0,0);
        const isToday = (cmp.getTime()===today.getTime());

        if(isToday) cell.classList.add('today');
        if(currentView==='month' && loopDate.getMonth()!==curMonth) cell.classList.add('other-month');

        if(currentView==='week'){
          const head=document.createElement('div');
          head.className='day-header-inline';
          const dn=loopDate.toLocaleDateString('en-US',{weekday:'long'});
          head.textContent = `${dn} ${loopDate.getDate()}` + (isToday? ' (Today)':'');
          cell.appendChild(head);
        }else{
          const dn=document.createElement('div');
          dn.className='day-number';
          dn.textContent = loopDate.getDate();
          cell.appendChild(dn);
        }

        const dayEvents = events.filter(ev=>{
          const d = new Date(ev.start.dateTime || ev.start.date);
          return d.toDateString() === loopDate.toDateString();
        }).sort((a,b)=>{
          const ta=new Date(a.start.dateTime||a.start.date);
          const tb=new Date(b.start.dateTime||b.start.date);
          return ta - tb;
        });

        dayEvents.forEach(ev=>{
          const a=document.createElement('a');
          a.className = `event ${ev.calendarType}`;

          let link = ev.htmlLink || '#';
          if(ev.description){
            const m = ev.description.match(/https?:\/\/[^\s<>"{}|\\^`[\]]+/i);
            if(m && m[0]) link = m[0];
          }
          a.href = link; a.target='_blank'; a.rel='noopener noreferrer';

          let timeText='';
          if(ev.start.dateTime){
            const t=new Date(ev.start.dateTime);
            timeText = t.toLocaleTimeString('en-US',{hour:'numeric', minute:'2-digit', hour12:true});
          }
          const title = ev.summary || 'Untitled Event';
          a.innerHTML = `<div>${title}</div>${timeText?`<div class="event-time">${timeText}</div>`:''}`;
          cell.appendChild(a);
        });

        colIndex = (colIndex+1) % 7;
        if(currentView==='month' && colIndex===0){
          cell.style.borderRight = 'none';
        }

        grid.appendChild(cell);
        loopDate.setDate(loopDate.getDate()+1);
      }
    }

    function previousPeriod(){
      if(currentView==='week'){ currentDate.setDate(currentDate.getDate()-7); }
      else{ currentDate.setMonth(currentDate.getMonth()-1); }
      resetAndLoad();
    }
    function nextPeriod(){
      if(currentView==='week'){ currentDate.setDate(currentDate.getDate()+7); }
      else{ currentDate.setMonth(currentDate.getMonth()+1); }
      resetAndLoad();
    }
    function goToToday(){
      currentDate = new Date(); resetAndLoad();
    }
    function resetAndLoad(){
      document.getElementById('loadingMessage').style.display='flex';
      document.getElementById('calendarGrid').style.display='none';
      loadCalendar();
    }

    function switchToMonth(){
      currentView='month';
      document.getElementById('monthViewBtn').classList.add('active');
      document.getElementById('weekViewBtn').classList.remove('active');
      document.getElementById('monthViewBtn').setAttribute('aria-pressed','true');
      document.getElementById('weekViewBtn').setAttribute('aria-pressed','false');
      resetAndLoad();
    }
    function switchToWeek(){
      currentView='week';
      document.getElementById('weekViewBtn').classList.add('active');
      document.getElementById('monthViewBtn').classList.remove('active');
      document.getElementById('weekViewBtn').setAttribute('aria-pressed','true');
      document.getElementById('monthViewBtn').setAttribute('aria-pressed','false');
      resetAndLoad();
    }

    document.getElementById('prevBtn').addEventListener('click', previousPeriod);
    document.getElementById('nextBtn').addEventListener('click', nextPeriod);
    document.getElementById('todayBtn').addEventListener('click', goToToday);
    document.getElementById('monthViewBtn').addEventListener('click', switchToMonth);
    document.getElementById('weekViewBtn').addEventListener('click', switchToWeek);

    document.addEventListener('DOMContentLoaded', initializeGapi);
  </script>
</body>
</html>
