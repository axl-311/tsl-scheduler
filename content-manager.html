<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSL Content Manager</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f5f7;
            color: #1d1d1f;
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
        }

        .version-badge {
            font-size: 12px;
            background: #007aff;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            margin-left: 10px;
            font-weight: 500;
        }

        .sync-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 16px;
            background: #e8e8e8;
            border-radius: 20px;
            font-size: 14px;
            color: #86868b;
        }

        .sync-status.connected {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .sync-status.error {
            background: #fce4ec;
            color: #c62828;
        }

        .nav-tabs {
            background: white;
            border-radius: 12px;
            padding: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            gap: 10px;
        }

        .nav-tab {
            padding: 10px 20px;
            border: none;
            background: #f0f0f2;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-tab:hover {
            background: #e0e0e2;
        }

        .nav-tab.active {
            background: #007aff;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: #007aff;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #0051d5;
        }

        .btn-success {
            background: #34c759;
            color: white;
        }

        .btn-success:hover {
            background: #30a852;
        }

        .btn-secondary {
            background: #f0f0f2;
            color: #1d1d1f;
        }

        .btn-secondary:hover {
            background: #e0e0e2;
        }

        .btn-danger {
            background: #ff3b30;
            color: white;
        }

        .btn-danger:hover {
            background: #d70015;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .stats-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-card {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 600;
            color: #007aff;
        }

        .stat-label {
            font-size: 14px;
            color: #86868b;
            margin-top: 5px;
        }

        .controls-bar {
            background: white;
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .search-section {
            display: flex;
            gap: 10px;
            align-items: center;
            flex: 1;
            max-width: 500px;
        }

        .search-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #d2d2d7;
            border-radius: 8px;
            font-size: 14px;
        }

        .search-input:focus {
            outline: none;
            border-color: #007aff;
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }

        .content-tabs {
            display: flex;
            gap: 10px;
        }

        .tab-button {
            padding: 8px 16px;
            border: 1px solid #d2d2d7;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .tab-button:hover {
            background: #f0f0f2;
        }

        .tab-button.active {
            background: #007aff;
            color: white;
            border-color: #007aff;
        }

        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .content-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .content-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .card-header {
            margin-bottom: 12px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 4px;
        }

        .card-meta {
            font-size: 12px;
            color: #86868b;
        }

        .card-details {
            margin-bottom: 15px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            font-size: 14px;
            border-bottom: 1px solid #f0f0f2;
        }

        .detail-label {
            color: #86868b;
        }

        .detail-value {
            color: #1d1d1f;
            font-weight: 500;
        }

        .card-actions {
            display: flex;
            gap: 10px;
        }

        .card-actions .btn {
            flex: 1;
            padding: 6px 12px;
            font-size: 13px;
        }

        .main-panel {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        .content-type-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            justify-content: center;
        }

        .type-option {
            padding: 12px 24px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            text-align: center;
            background: white;
            font-size: 14px;
        }

        .type-option:hover {
            border-color: #007aff;
            background: #f0f7ff;
        }

        .type-option.active {
            border-color: #007aff;
            background: #007aff;
            color: white;
        }

        .upload-section {
            border: 3px dashed #007aff;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            background: #f0f7ff;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-section:hover {
            border-color: #0051d5;
            background: #e3f2ff;
        }

        .upload-section.dragover {
            border-color: #34c759;
            background: #e8f5e9;
        }

        .file-input {
            display: none;
        }

        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .form-section h3 {
            color: #1d1d1f;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 600;
            border-bottom: 2px solid #007aff;
            padding-bottom: 10px;
        }

        .form-grid-three {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: 6px;
            color: #1d1d1f;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d2d2d7;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            background: white;
        }

        .form-input:focus {
            outline: none;
            border-color: #007aff;
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }

        textarea.form-input {
            resize: vertical;
            min-height: 100px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #86868b;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #323232;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            animation: slideIn 0.3s ease;
            font-size: 14px;
        }

        @keyframes slideIn {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .hidden {
            display: none;
        }

        .extraction-preview {
            background: #e3f2fd;
            border: 1px solid #90caf9;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .raw-text-viewer {
            background: #f8f9fa;
            border: 1px solid #d2d2d7;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .raw-text-content {
            background: white;
            border: 1px solid #d2d2d7;
            border-radius: 6px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'SF Mono', Monaco, 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.5;
            white-space: pre-wrap;
            color: #333;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #86868b;
        }

        .spinner {
            border: 3px solid #f0f0f2;
            border-top: 3px solid #007aff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .image-upload-area {
            border: 2px dashed #d2d2d7;
            border-radius: 8px;
            background: #fafafa;
            position: relative;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .image-upload-area:hover {
            border-color: #007aff;
            background: #f0f7ff;
        }

        .upload-placeholder {
            text-align: center;
            cursor: pointer;
            padding: 20px;
            width: 100%;
        }

        .upload-placeholder span {
            display: block;
            font-weight: 500;
            color: #007aff;
            margin-bottom: 5px;
        }

        .upload-hint {
            font-size: 12px;
            color: #86868b;
        }

        .image-preview {
            position: relative;
            width: 100%;
            height: 120px;
            border-radius: 6px;
            overflow: hidden;
        }

        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 6px;
        }

        .remove-image-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 59, 48, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 16px;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remove-image-btn:hover {
            background: rgba(255, 59, 48, 1);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <div>
                <h1>TSL Content Manager<span class="version-badge">v2.0</span></h1>
            </div>
            <div class="sync-status" id="connectionStatus">
                <span>○</span>
                <span>Connecting...</span>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('dashboard')">
                Dashboard
            </button>
            <button class="nav-tab" onclick="switchTab('importer')">
                Importer
            </button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard-tab" class="tab-content active">
            <div class="stats-section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="moviesCount">0</div>
                        <div class="stat-label">Movies</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="eventsCount">0</div>
                        <div class="stat-label">Events</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="galleriesCount">0</div>
                        <div class="stat-label">Galleries</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalCount">0</div>
                        <div class="stat-label">Total Items</div>
                    </div>
                </div>
            </div>

            <div class="controls-bar">
                <div class="search-section">
                    <input type="text" id="searchInput" class="search-input" placeholder="Search by title...">
                    <button onclick="searchContent()" class="btn btn-primary">Search</button>
                </div>
                <div class="content-tabs">
                    <button class="tab-button active" onclick="filterContent('all')">All</button>
                    <button class="tab-button" onclick="filterContent('movies')">Movies</button>
                    <button class="tab-button" onclick="filterContent('events')">Events</button>
                    <button class="tab-button" onclick="filterContent('galleries')">Galleries</button>
                </div>
            </div>

            <div id="contentContainer">
                <div class="loading">
                    <div class="spinner"></div>
                    <div>Loading content...</div>
                </div>
            </div>
        </div>

        <!-- Importer Tab -->
        <div id="importer-tab" class="tab-content">
            <div class="main-panel">
                <div class="content-type-selector">
                    <div class="type-option active" onclick="selectContentType('movie')">Movie</div>
                    <div class="type-option" onclick="selectContentType('event')">Event</div>
                    <div class="type-option" onclick="selectContentType('gallery')">Gallery</div>
                </div>
                
                <div class="upload-section" id="uploadSection">
                    <div style="font-size: 18px; color: #007aff; margin-bottom: 10px; font-weight: 600;">
                        Drop Press Kit PDF Here
                    </div>
                    <div style="color: #86868b; font-size: 14px;">Or click to browse files</div>
                    <input type="file" id="fileInput" class="file-input" accept=".pdf,.txt">
                    <button onclick="document.getElementById('fileInput').click()" class="btn btn-primary" style="margin-top: 15px;">
                        Choose File
                    </button>
                </div>
                
                <div id="extractionPreview" class="extraction-preview hidden">
                    <h4>Extracted Information</h4>
                    <div id="extractedData"></div>
                    <div class="action-buttons">
                        <button onclick="toggleRawText()" class="btn btn-secondary">Show Raw Text</button>
                        <button onclick="downloadData()" class="btn btn-success">Download Data</button>
                    </div>
                </div>

                <div id="rawTextViewer" class="raw-text-viewer hidden">
                    <h4>Raw Extracted Text</h4>
                    <div class="raw-text-content" id="rawTextContent"></div>
                    <button onclick="copyRawText()" class="btn btn-secondary" style="margin-top: 10px;">
                        Copy to Clipboard
                    </button>
                </div>
                
                <div class="form-section">
                    <h3 id="formTitle">Movie Details</h3>
                    <div class="form-grid-three">
                        <div class="form-group">
                            <label class="form-label">Title *</label>
                            <input type="text" id="title" class="form-input" />
                        </div>
                        <div class="form-group">
                            <label class="form-label">Director</label>
                            <input type="text" id="director" class="form-input" />
                        </div>
                        <div class="form-group">
                            <label class="form-label">Runtime (minutes)</label>
                            <input type="number" id="runtime_minutes" class="form-input" />
                        </div>
                        <div class="form-group">
                            <label class="form-label">Release Year</label>
                            <input type="number" id="year" class="form-input" />
                        </div>
                        <div class="form-group">
                            <label class="form-label">Language</label>
                            <input type="text" id="language" class="form-input" />
                        </div>
                        <div class="form-group">
                            <label class="form-label">Distributor</label>
                            <input type="text" id="distributor" class="form-input" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Logline</label>
                        <textarea id="logline" class="form-input" rows="2"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Synopsis</label>
                        <textarea id="synopsis" class="form-input" rows="5"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Critics Quote</label>
                        <textarea id="criticsQuote" class="form-input" rows="2"></textarea>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3>Images</h3>
                    <div class="form-grid-three">
                        <div class="form-group">
                            <label class="form-label">Poster Image</label>
                            <div class="image-upload-area" id="posterUpload">
                                <input type="file" id="posterInput" accept="image/*" style="display: none;">
                                <div class="upload-placeholder" onclick="document.getElementById('posterInput').click()">
                                    <span>Click to upload poster</span>
                                    <div class="upload-hint">JPG, PNG, WebP (max 5MB)</div>
                                </div>
                                <div id="posterPreview" class="image-preview hidden">
                                    <img id="posterImg" src="" alt="Poster preview">
                                    <button type="button" onclick="removePosterImage()" class="remove-image-btn">×</button>
                                </div>
                            </div>
                            <input type="hidden" id="poster_url" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Web Graphics</label>
                            <div class="image-upload-area" id="webGraphicsUpload">
                                <input type="file" id="webGraphicsInput" accept="image/*" style="display: none;">
                                <div class="upload-placeholder" onclick="document.getElementById('webGraphicsInput').click()">
                                    <span>Click to upload web graphics</span>
                                    <div class="upload-hint">JPG, PNG, WebP (max 5MB)</div>
                                </div>
                                <div id="webGraphicsPreview" class="image-preview hidden">
                                    <img id="webGraphicsImg" src="" alt="Web graphics preview">
                                    <button type="button" onclick="removeWebGraphicsImage()" class="remove-image-btn">×</button>
                                </div>
                            </div>
                            <input type="hidden" id="web_graphics_url" class="form-input">
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3>Media Links</h3>
                    <div class="form-grid-three">
                        <div class="form-group">
                            <label class="form-label">Trailer URL</label>
                            <input type="url" id="trailerUrl" class="form-input" />
                        </div>
                        <div class="form-group">
                            <label class="form-label">SimpleTix Embed Code</label>
                            <input type="text" id="simpletix_embed_code" class="form-input" />
                        </div>
                    </div>
                </div>
                
                <button onclick="saveContent()" id="saveBtn" class="btn btn-success" style="width: 100%; margin-top: 20px; padding: 12px;">
                    <span id="saveButtonText">Save Movie to Database</span>
                </button>
            </div>
        </div>
    </div>
// TSL Content Manager - Complete JavaScript Code
// Add this script tag before closing </body> tag in Part 1

// Initialize PDF.js
pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

// Global variables
let supabase = null;
let currentContentType = 'movie';
let currentTab = 'all';
let allContent = [];

// Initialize Supabase
async function initSupabase() {
    const url = 'https://tnnkfnattwpqqrydsyux.supabase.co';
    const key = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRubmtmbmF0dHdwcXFyeWRzeXV4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0Njc3NDAsImV4cCI6MjA3MzA0Mzc0MH0.cNzStE1v6YA7HRvTeBCXxGFPuJPq1WmnuVGVaNLjOsE';
    
    try {
        supabase = window.supabase.createClient(url, key);
        
        const { error } = await supabase.from('movies').select('count').limit(1);
        if (error) throw error;
        
        const statusEl = document.getElementById('connectionStatus');
        statusEl.classList.add('connected');
        statusEl.innerHTML = '<span>✓</span><span>Connected</span>';
        
        await loadContent();
    } catch (error) {
        console.error('Connection error:', error);
        const statusEl = document.getElementById('connectionStatus');
        statusEl.classList.add('error');
        statusEl.innerHTML = '<span>✗</span><span>Connection failed</span>';
    }
}

// Switch tabs
function switchTab(tab) {
    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    
    if (tab === 'dashboard') {
        document.querySelector('.nav-tab:first-child').classList.add('active');
        document.getElementById('dashboard-tab').classList.add('active');
        loadContent();
    } else {
        document.querySelector('.nav-tab:last-child').classList.add('active');
        document.getElementById('importer-tab').classList.add('active');
    }
}

// Select content type
function selectContentType(type) {
    currentContentType = type;
    document.querySelectorAll('.type-option').forEach(opt => opt.classList.remove('active'));
    event.target.classList.add('active');
    
    const titleMap = {
        'movie': 'Movie Details',
        'event': 'Event Details',
        'gallery': 'Gallery Details'
    };
    document.getElementById('formTitle').textContent = titleMap[type];
    document.getElementById('saveButtonText').textContent = `Save ${type.charAt(0).toUpperCase() + type.slice(1)} to Database`;
}

// Load content
async function loadContent() {
    if (!supabase) return;
    
    try {
        const [moviesRes, eventsRes, galleriesRes] = await Promise.all([
            supabase.from('movies').select('*').order('created_at', { ascending: false }),
            supabase.from('events').select('*').order('created_at', { ascending: false }),
            supabase.from('galleries').select('*').order('created_at', { ascending: false })
        ]);
        
        const movies = moviesRes.data || [];
        const events = eventsRes.data || [];
        const galleries = galleriesRes.data || [];
        
        document.getElementById('moviesCount').textContent = movies.length;
        document.getElementById('eventsCount').textContent = events.length;
        document.getElementById('galleriesCount').textContent = galleries.length;
        document.getElementById('totalCount').textContent = movies.length + events.length + galleries.length;
        
        allContent = [
            ...movies.map(m => ({ ...m, type: 'movie' })),
            ...events.map(e => ({ ...e, type: 'event' })),
            ...galleries.map(g => ({ ...g, type: 'gallery' }))
        ];
        
        renderContent();
    } catch (error) {
        console.error('Load error:', error);
        showToast('Failed to load content');
    }
}

// Render content
function renderContent(searchTerm = '') {
    let filteredContent = allContent;
    
    if (currentTab !== 'all') {
        const typeMap = { 'movies': 'movie', 'events': 'event', 'galleries': 'gallery' };
        filteredContent = filteredContent.filter(item => item.type === typeMap[currentTab]);
    }
    
    if (searchTerm) {
        filteredContent = filteredContent.filter(item => {
            const title = item.title || item.event_name || item.exhibition_title || '';
            return title.toLowerCase().includes(searchTerm.toLowerCase());
        });
    }
    
    const container = document.getElementById('contentContainer');
    
    if (filteredContent.length === 0) {
        container.innerHTML = '<div class="empty-state">No content found</div>';
        return;
    }
    
    let html = '<div class="content-grid">';
    filteredContent.forEach(item => {
        const title = item.title || item.event_name || item.exhibition_title;
        const creator = item.director || item.presenter || item.artist || 'N/A';
        
        html += `
            <div class="content-card">
                <div class="card-header">
                    <div class="card-title">${title}</div>
                    <div class="card-meta">${item.type.charAt(0).toUpperCase() + item.type.slice(1)}</div>
                </div>
                <div class="card-details">
                    <div class="detail-item">
                        <span class="detail-label">Creator:</span>
                        <span class="detail-value">${creator}</span>
                    </div>
                </div>
                <div class="card-actions">
                    <button class="btn btn-secondary" onclick="editContent('${item.id}', '${item.type}')">Edit</button>
                    <button class="btn btn-danger" onclick="deleteContent('${item.id}', '${item.type}')">Delete</button>
                </div>
            </div>
        `;
    });
    html += '</div>';
    
    container.innerHTML = html;
}

// Search content
function searchContent() {
    const searchTerm = document.getElementById('searchInput').value;
    renderContent(searchTerm);
}

// Filter content
function filterContent(type) {
    currentTab = type;
    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    renderContent();
}

// Fix common PDF spacing issues
function fixSpacing(str) {
    return str
        .replace(/â€™/g, "'")
        .replace(/â€œ/g, '"')
        .replace(/â€\x9D/g, '"')
        .replace(/â€"/g, '—')
        .replace(/â€"/g, '–')
        .replace(/Â/g, '')
        .replace(/\bcar\s+toon/gi, 'cartoon')
        .replace(/\bar\s+t\b/gi, 'art')
        .replace(/\bSav\s+age/gi, 'Savage')
        .replace(/\bAr\s+t/gi, 'Art')
        .replace(/\bOliph\s+ant/gi, 'Oliphant')
        .replace(/([a-z])\s+([a-z]{1,3})\b/g, (match, p1, p2) => {
            if (p2.length <= 2) return p1 + p2;
            return match;
        })
        .replace(/\.\s*\n\s*/g, '. ')
        .replace(/([.!?])\s*\n\s*([A-Z])/g, '$1\n\n$2')
        .replace(/\n\s*\n\s*\n+/g, '\n\n')
        .replace(/ +/g, ' ')
        .replace(/\n +/g, '\n')
        .replace(/ +\n/g, '\n')
        .trim();
}

// Extract movie data
function extractMovieData(text) {
    const cleanedText = fixSpacing(text);
    const lines = cleanedText.split('\n').map(line => line.trim()).filter(line => line.length > 0);
    
    const data = {
        title: '',
        director: '',
        runtime: '',
        year: '',
        language: '',
        distributor: '',
        logline: '',
        synopsis: ''
    };

    // Enhanced title extraction
    const fullText = cleanedText.toLowerCase();
    if (fullText.includes('savage') && fullText.includes('art')) {
        data.title = 'A Savage Art';
    } else {
        const titlePatterns = [
            /^([A-Z][A-Z\s&]+)$/m,
            /^"([^"]+)"$/m,
            /\*\*([^*]+)\*\*/,
            /(?:PRESENTS?|RELEASE)\s+([A-Z][A-Za-z\s&]+?)(?:\n|Written|Directed|A\s+Film)/i
        ];
        
        for (const pattern of titlePatterns) {
            const match = cleanedText.match(pattern);
            if (match) {
                let title = match[1] || match[0];
                title = fixSpacing(title).trim();
                if (title && 
                    title.length > 2 && 
                    title.length < 100 &&
                    !title.match(/^(LOGLINE|SYNOPSIS|PRESS|FINAL|DISTRIBUTOR|CONTACT|CAST|CREW)/i)) {
                    data.title = title.replace(/\s+/g, ' ').trim();
                    break;
                }
            }
        }
        
        if (!data.title) {
            for (let i = 0; i < Math.min(20, lines.length); i++) {
                const line = fixSpacing(lines[i]);
                
                if (line && 
                    line.length > 2 && 
                    line.length < 80 &&
                    (line === line.toUpperCase() || line.match(/^[A-Z]/)) &&
                    !line.match(/^(MAGNET|FINAL|PRESS|NOTES|CONTACT|DISTRIBUTOR|PUBLICITY|CAST|CREW|SYNOPSIS|LOGLINE)/i) &&
                    !line.includes('@') &&
                    !line.match(/^\d{4}/) &&
                    !line.match(/\.(com|org|net)$/i)) {
                    data.title = line;
                    break;
                }
            }
        }
    }

    // Director extraction
    if (fullText.includes('bill') && fullText.includes('banowsky')) {
        data.director = 'Bill Banowsky';
    } else if (fullText.includes('banowsky')) {
        data.director = 'Bill Banowsky';
    } else {
        const directorPatterns = [
            /(?:Directed\s+and\s+Produced\s+by|Directed\s+by)\s+([A-Z][a-z]+\s+[A-Z][a-z]+)/i,
            /(?:Written\s+(?:and|&)\s+)?Directed\s+by\s+([A-Z][a-zA-Z\s]+?)(?:\n|$|\.|\||Running|Produced)/i,
            /(?:A\s+Film\s+by|Director)\s*:?\s*([A-Z][a-zA-Z\s]+?)(?:\n|$|\.|\||Running)/i,
            /(?:FILMED\s+AND\s+DIRECTED\s+BY|DIRECTED\s+BY)\s+([A-Z][a-zA-Z\s]+?)(?:\n|$|PRODUCED)/i
        ];
        
        for (const pattern of directorPatterns) {
            const match = cleanedText.match(pattern);
            if (match && match[1]) {
                let directorName = match[1].trim()
                    .replace(/\b\w/g, l => l.toUpperCase())
                    .replace(/\s+/g, ' ');
                
                directorName = directorName.replace(/\b(And|The|Of|In|On|At|To|For|With|By)\b$/i, '').trim();
                
                if (directorName.length >= 5 && directorName.length <= 50 &&
                    directorName.includes(' ') &&
                    !directorName.match(/\b(debut|feature|film|movie|story|cast|crew|page|press|kit|notes)\b/i)) {
                    data.director = directorName;
                    break;
                }
            }
        }
    }

    // Runtime extraction
    const runtimePatterns = [
        /(\d{2,3})\s*(?:minutes?|mins?|min)\b/i,
        /runtime[:\s]*(\d{2,3})\s*(?:minutes?|mins?)/i,
        /\|\s*(\d{2,3})\s*(?:minutes?|mins?)\s*\|/i,
        /\b(\d{2,3})\s*min\b/i,
        /\b(\d{2,3})\s*m\b/i,
        /(\d{2,3})\s*\/\s*\d{4}/i,
        /running\s*time[:\s]*(\d{2,3})/i,
        /duration[:\s]*(\d{2,3})/i,
        /\b(\d):(\d{2})\b/,
        /documentary/i
    ];
    
    for (const pattern of runtimePatterns) {
        const match = cleanedText.match(pattern);
        if (match) {
            if (match[1] && match[2]) {
                const hours = parseInt(match[1]);
                const minutes = parseInt(match[2]);
                const totalMinutes = (hours * 60) + minutes;
                if (totalMinutes >= 40 && totalMinutes <= 300) {
                    data.runtime = totalMinutes.toString();
                    break;
                }
            } else if (match[1]) {
                const runtime = parseInt(match[1]);
                if (runtime >= 40 && runtime <= 300) {
                    data.runtime = runtime.toString();
                    break;
                }
            } else if (match[0].match(/documentary/i) && !data.runtime) {
                data.runtime = "90";
            }
        }
    }

    // Year extraction
    const yearPatterns = [
        /\b(20[0-2][0-9])\b/g,
        /\|\s*(20[0-2][0-9])\s*\|/g
    ];
    
    for (const pattern of yearPatterns) {
        const matches = cleanedText.match(pattern);
        if (matches) {
            for (const match of matches) {
                const year = parseInt(match.replace(/[^\d]/g, ''));
                if (year >= 2022 && year <= 2030) {
                    data.year = year.toString();
                    break;
                }
            }
            if (data.year) break;
        }
    }

    // Language extraction
    const languagePatterns = [
        /\b(English|German|French|Spanish|Italian|Japanese|Korean|Mandarin|Portuguese)\b/i,
        /(English|German|French|Spanish|Italian|Japanese|Korean|Mandarin|Portuguese)\s+with\s+English\s+subtitles/i,
        /\|\s*(English|German|French|Spanish|Italian|Japanese|Korean|Mandarin|Portuguese)\s*\|/i
    ];
    
    for (const pattern of languagePatterns) {
        const match = cleanedText.match(pattern);
        if (match && match[1] && match[1].length > 2) {
            data.language = match[1].charAt(0).toUpperCase() + match[1].slice(1).toLowerCase();
            break;
        }
    }

    // Distributor extraction
    const distributorPatterns = [
        /\b(Magnolia Pictures|Kino Lorber|A24|Netflix|Amazon|Sony Pictures|Universal|Warner|Disney|Paramount|Fox|Lionsgate|Focus Features|Searchlight|Neon|Bleecker Street)\b/i,
        /\b([A-Z][a-z]+\s+(?:Pictures|Films|Entertainment|Media|Studios|Distribution))\b/i
    ];
    
    for (const pattern of distributorPatterns) {
        const match = cleanedText.match(pattern);
        if (match) {
            data.distributor = match[1] || match[0];
            break;
        }
    }

    // Logline extraction
    const loglinePatterns = [
        /LOGLINE\s+(.*?)(?=\s+[A-Z][a-z]+\s+[a-z]+\s+[a-z]+|A\s+Savage\s+art|\n\n|$)/is,
        /Patrick\s+Oliphant\s+was\s+a\s+giant\s+slayer[^.]*\./i,
        /(.*?(?:giant\s+slayer|fearless\s+stunt\s+pilot).*?\.)/i,
        /(?:logline|log\s*line)[:\s]+(.*?)(?:\n\n|\n[A-Z]|$)/is
    ];
    
    for (const pattern of loglinePatterns) {
        const match = cleanedText.match(pattern);
        if (match && match[1]) {
            let logline = fixSpacing(match[1].trim());
            logline = logline.replace(/^(LOGLINE|LOG\s*LINE)\s*/i, '').trim();
            if (logline.length > 20 && logline.length < 400) {
                data.logline = logline;
                break;
            }
        } else if (match && match[0] && !match[1]) {
            let logline = fixSpacing(match[0].trim());
            logline = logline.replace(/^(LOGLINE|LOG\s*LINE)\s*/i, '').trim();
            if (logline.length > 20 && logline.length < 400) {
                data.logline = logline;
                break;
            }
        }
    }

    // Synopsis extraction
    const synopsisPatterns = [
        /(?:synopsis|summary)[:\s]+(.*?)(?:\n\n|\n[A-Z]|$)/is,
        /(?:^|\n\n)(.*?)(?=\n\nDIRECTOR|\n\nCAST|\n\nCREDITS|$)/is,
        /LOGLINE\s+(.*?)(?=\n\n(?:DIRECTOR|CAST|CREDITS|ABOUT)|$)/is
    ];
    
    for (const pattern of synopsisPatterns) {
        const match = cleanedText.match(pattern);
        if (match && match[1] && match[1].length > 100) {
            let synopsis = match[1].trim();
            
            synopsis = synopsis.replace(/^(SYNOPSIS|LOGLINE)\s*/i, '').trim();
            
            synopsis = synopsis
                .replace(/\n\s*\n/g, '||PARAGRAPH||')
                .replace(/\n/g, ' ')
                .replace(/\|\|PARAGRAPH\|\|/g, '\n\n')
                .replace(/\s+/g, ' ')
                .trim();
            
            if (synopsis.length > 100) {
                if (synopsis.length > 2000) {
                    synopsis = synopsis.substring(0, 2000);
                    const lastPeriod = synopsis.lastIndexOf('.');
                    if (lastPeriod > 1500) {
                        synopsis = synopsis.substring(0, lastPeriod + 1);
                    }
                    synopsis += '...';
                }
                data.synopsis = synopsis;
                break;
            }
        }
    }

    return data;
}

// Handle file upload
function handleFile(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    if (file.type === 'application/pdf') {
        processPDF(file);
    } else if (file.type === 'text/plain') {
        processTextFile(file);
    } else {
        showToast('Please upload a PDF or text file');
    }
}

// Process PDF
async function processPDF(file) {
    try {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
        let fullText = '';
        
        for (let i = 1; i <= pdf.numPages; i++) {
            const page = await pdf.getPage(i);
            const textContent = await page.getTextContent();
            const pageText = textContent.items.map(item => item.str).join(' ');
            fullText += pageText + '\n';
        }
        
        parseContent(fullText);
        showToast('PDF processed successfully');
    } catch (error) {
        console.error('PDF processing error:', error);
        showToast('Error processing PDF');
    }
}

// Process text file
async function processTextFile(file) {
    try {
        const text = await file.text();
        parseContent(text);
        showToast('Text file processed successfully');
    } catch (error) {
        console.error('Text file error:', error);
        showToast('Error processing text file');
    }
}

// Parse content
function parseContent(text) {
    document.getElementById('rawTextContent').textContent = text;
    
    const extractedData = extractMovieData(text);
    
    displayExtractedData(extractedData);
    fillForm(extractedData);
    
    document.getElementById('extractionPreview').classList.remove('hidden');
}

// Display extracted data
function displayExtractedData(data) {
    const container = document.getElementById('extractedData');
    let html = '';
    
    for (const [key, value] of Object.entries(data)) {
        if (value) {
            const label = key.charAt(0).toUpperCase() + key.slice(1);
            html += `<div><strong>${label}:</strong> ${value}</div>`;
        }
    }
    
    container.innerHTML = html || '<div>No data extracted</div>';
}

// Fill form
function fillForm(data) {
    document.getElementById('title').value = data.title || '';
    document.getElementById('director').value = data.director || '';
    document.getElementById('runtime_minutes').value = data.runtime || '';
    document.getElementById('year').value = data.year || '';
    document.getElementById('language').value = data.language || '';
    document.getElementById('distributor').value = data.distributor || '';
    document.getElementById('logline').value = data.logline || '';
    document.getElementById('synopsis').value = data.synopsis || '';
    document.getElementById('criticsQuote').value = data.criticsQuote || '';
}

// Toggle raw text
function toggleRawText() {
    const viewer = document.getElementById('rawTextViewer');
    viewer.classList.toggle('hidden');
}

// Copy raw text
function copyRawText() {
    const text = document.getElementById('rawTextContent').textContent;
    navigator.clipboard.writeText(text).then(() => {
        showToast('Copied to clipboard');
    });
}

// Download data
function downloadData() {
    const title = document.getElementById('title').value || 'extracted';
    const data = {
        title: document.getElementById('title').value,
        director: document.getElementById('director').value,
        runtime_minutes: document.getElementById('runtime_minutes').value,
        year: document.getElementById('year').value,
        language: document.getElementById('language').value,
        distributor: document.getElementById('distributor').value,
        logline: document.getElementById('logline').value,
        synopsis: document.getElementById('synopsis').value,
        criticsQuote: document.getElementById('criticsQuote').value
    };
    
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${title}.json`;
    a.click();
    URL.revokeObjectURL(url);
}

// Image upload functions
async function uploadImage(file, bucket, folder = '') {
    if (!supabase) {
        throw new Error('Database not connected');
    }

    if (!file.type.startsWith('image/')) {
        throw new Error('Please select an image file');
    }

    if (file.size > 5 * 1024 * 1024) {
        throw new Error('Image must be smaller than 5MB');
    }

    const fileExt = file.name.split('.').pop();
    const fileName = `${Date.now()}-${Math.random().toString(36).substring(2)}.${fileExt}`;
    const filePath = folder ? `${folder}/${fileName}` : fileName;

    try {
        const { data, error } = await supabase.storage
            .from(bucket)
            .upload(filePath, file);

        if (error) throw error;

        const { data: urlData } = supabase.storage
            .from(bucket)
            .getPublicUrl(filePath);

        return urlData.publicUrl;
    } catch (error) {
        console.error('Upload error:', error);
        throw error;
    }
}

async function handlePosterUpload(event) {
    const file = event.target.files[0];
    if (!file) return;

    try {
        showToast('Uploading poster...');
        
        const url = await uploadImage(file, 'posters');
        
        document.getElementById('poster_url').value = url;
        document.getElementById('posterImg').src = url;
        document.getElementById('posterPreview').classList.remove('hidden');
        document.querySelector('#posterUpload .upload-placeholder').style.display = 'none';
        
        showToast('Poster uploaded successfully!');
    } catch (error) {
        showToast('Upload failed: ' + error.message);
    }
}

async function handleWebGraphicsUpload(event) {
    const file = event.target.files[0];
    if (!file) return;

    try {
        showToast('Uploading web graphics...');
        
        const url = await uploadImage(file, 'web-graphics');
        
        document.getElementById('web_graphics_url').value = url;
        document.getElementById('webGraphicsImg').src = url;
        document.getElementById('webGraphicsPreview').classList.remove('hidden');
        document.querySelector('#webGraphicsUpload .upload-placeholder').style.display = 'none';
        
        showToast('Web graphics uploaded successfully!');
    } catch (error) {
        showToast('Upload failed: ' + error.message);
    }
}

function removePosterImage() {
    document.getElementById('poster_url').value = '';
    document.getElementById('posterImg').src = '';
    document.getElementById('posterPreview').classList.add('hidden');
    document.querySelector('#posterUpload .upload-placeholder').style.display = 'block';
    document.getElementById('posterInput').value = '';
}

function removeWebGraphicsImage() {
    document.getElementById('web_graphics_url').value = '';
    document.getElementById('webGraphicsImg').src = '';
    document.getElementById('webGraphicsPreview').classList.add('hidden');
    document.querySelector('#webGraphicsUpload .upload-placeholder').style.display = 'block';
    document.getElementById('webGraphicsInput').value = '';
}

// Edit content
async function editContent(id, type) {
    try {
        const table = type === 'movie' ? 'movies' : 
                     type === 'event' ? 'events' : 'galleries';
        
        const { data, error } = await supabase.from(table).select('*').eq('id', id).single();
        
        if (error) throw error;
        
        switchTab('importer');
        
        currentContentType = type;
        document.querySelectorAll('.type-option').forEach(opt => opt.classList.remove('active'));
        document.querySelector(`.type-option:nth-child(${type === 'movie' ? '1' : type === 'event' ? '2' : '3'})`).classList.add('active');
        
        const titleMap = {
            'movie': 'Movie Details',
            'event': 'Event Details', 
            'gallery': 'Gallery Details'
        };
        document.getElementById('formTitle').textContent = titleMap[type] + ' (Editing)';
        document.getElementById('saveButtonText').textContent = `Update ${type.charAt(0).toUpperCase() + type.slice(1)}`;
        
        document.getElementById('title').value = data.title || data.event_name || data.exhibition_title || '';
        document.getElementById('director').value = data.director || data.presenter || data.artist || '';
        document.getElementById('runtime_minutes').value = data.runtime_minutes || data.duration_minutes || '';
        document.getElementById('year').value = data.release_year || data.event_year || data.exhibition_year || '';
        document.getElementById('language').value = data.language || data.event_type || data.art_medium || '';
        document.getElementById('distributor').value = data.distributor || data.venue || data.gallery_space || '';
        document.getElementById('logline').value = data.logline || '';
        document.getElementById('synopsis').value = data.synopsis || data.description || '';
        document.getElementById('criticsQuote').value = data.critics_quote || '';
        document.getElementById('trailerUrl').value = data.trailer_url || '';
        document.getElementById('simpletix_embed_code').value = data.simpletix_embed_code || '';
        
        if (data.poster_url) {
            document.getElementById('poster_url').value = data.poster_url;
            document.getElementById('posterImg').src = data.poster_url;
            document.getElementById('posterPreview').classList.remove('hidden');
            document.querySelector('#posterUpload .upload-placeholder').style.display = 'none';
        }
        
        if (data.web_graphics_url) {
            document.getElementById('web_graphics_url').value = data.web_graphics_url;
            document.getElementById('webGraphicsImg').src = data.web_graphics_url;
            document.getElementById('webGraphicsPreview').classList.remove('hidden');
            document.querySelector('#webGraphicsUpload .upload-placeholder').style.display = 'none';
        }
        
        document.getElementById('saveBtn').setAttribute('data-editing-id', id);
        document.getElementById('saveBtn').setAttribute('data-editing-type', type);
        
        showToast('Loaded for editing');
        
    } catch (error) {
        console.error('Edit load error:', error);
        showToast('Failed to load item for editing');
    }
}

// Save content
async function saveContent() {
    if (!supabase) {
        showToast('Database not connected');
        return;
    }
    
    const title = document.getElementById('title').value.trim();
    if (!title) {
        showToast('Please enter a title');
        return;
    }
    
    try {
        const table = currentContentType === 'movie' ? 'movies' : 
                     currentContentType === 'event' ? 'events' : 'galleries';
        
        const data = {
            title: title,
            director: document.getElementById('director').value || null,
            runtime_minutes: parseInt(document.getElementById('runtime_minutes').value) || null,
            release_year: parseInt(document.getElementById('year').value) || null,
            language: document.getElementById('language').value || null,
            distributor: document.getElementById('distributor').value || null,
            logline: document.getElementById('logline').value || null,
            synopsis: document.getElementById('synopsis').value || null,
            critics_quote: document.getElementById('criticsQuote').value || null,
            trailer_url: document.getElementById('trailerUrl').value || null,
            simpletix_embed_code: document.getElementById('simpletix_embed_code').value || null,
            poster_url: document.getElementById('poster_url').value || null,
            web_graphics_url: document.getElementById('web_graphics_url').value || null
        };
        
        if (currentContentType === 'event') {
            data.event_name = title;
            data.presenter = data.director;
            data.duration_minutes = data.runtime_minutes;
            data.event_type = data.language;
            data.venue = data.distributor;
            data.event_year = data.release_year;
        } else if (currentContentType === 'gallery') {
            data.exhibition_title = title;
            data.artist = data.director;
            data.art_medium = data.language;
            data.gallery_space = data.distributor;
            data.exhibition_year = data.release_year;
        }
        
        const saveBtn = document.getElementById('saveBtn');
        const editingId = saveBtn.getAttribute('data-editing-id');
        
        if (editingId) {
            const { error } = await supabase.from(table).update(data).eq('id', editingId);
            if (error) throw error;
            showToast('Updated successfully!');
            
            saveBtn.removeAttribute('data-editing-id');
            saveBtn.removeAttribute('data-editing-type');
            document.getElementById('formTitle').textContent = document.getElementById('formTitle').textContent.replace(' (Editing)', '');
            document.getElementById('saveButtonText').textContent = `Save ${currentContentType.charAt(0).toUpperCase() + currentContentType.slice(1)} to Database`;
        } else {
            const { error } = await supabase.from(table).insert([data]);
            if (error) throw error;
            showToast('Saved successfully!');
        }
        
        clearForm();
        loadContent();
        
    } catch (error) {
        console.error('Save error:', error);
        showToast('Failed to save content');
    }
}

// Delete content
async function deleteContent(id, type) {
    if (!confirm('Are you sure you want to delete this item? This action cannot be undone.')) {
        return;
    }
    
    try {
        const table = type === 'movie' ? 'movies' : 
                     type === 'event' ? 'events' : 'galleries';
        
        const { error } = await supabase.from(table).delete().eq('id', id);
        
        if (error) throw error;
        
        showToast('Item deleted successfully');
        loadContent();
        
    } catch (error) {
        console.error('Delete error:', error);
        showToast('Failed to delete item');
    }
}

// Clear form
function clearForm() {
    document.getElementById('title').value = '';
    document.getElementById('director').value = '';
    document.getElementById('runtime_minutes').value = '';
    document.getElementById('year').value = '';
    document.getElementById('language').value = '';
    document.getElementById('distributor').value = '';
    document.getElementById('logline').value = '';
    document.getElementById('synopsis').value = '';
    document.getElementById('criticsQuote').value = '';
    document.getElementById('trailerUrl').value = '';
    document.getElementById('simpletix_embed_code').value = '';
    document.getElementById('poster_url').value = '';
    document.getElementById('web_graphics_url').value = '';
    
    // Reset image previews
    removePosterImage();
    removeWebGraphicsImage();
    
    // Hide extraction preview
    document.getElementById('extractionPreview').classList.add('hidden');
    document.getElementById('rawTextViewer').classList.add('hidden');
}

// Show toast notification
function showToast(message) {
    // Remove existing toast if any
    const existingToast = document.querySelector('.toast');
    if (existingToast) {
        existingToast.remove();
    }
    
    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.remove();
    }, 3000);
}

// Event listeners
document.addEventListener('DOMContentLoaded', function() {
    // Initialize app
    initSupabase();
    
    // File upload handling
    document.getElementById('fileInput').addEventListener('change', handleFile);
    
    // Image upload handlers
    document.getElementById('posterInput').addEventListener('change', handlePosterUpload);
    document.getElementById('webGraphicsInput').addEventListener('change', handleWebGraphicsUpload);
    
    // Drag and drop handling
    const uploadSection = document.getElementById('uploadSection');
    
    uploadSection.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadSection.classList.add('dragover');
    });
    
    uploadSection.addEventListener('dragleave', (e) => {
        e.preventDefault();
        uploadSection.classList.remove('dragover');
    });
    
    uploadSection.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadSection.classList.remove('dragover');
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            const file = files[0];
            if (file.type === 'application/pdf' || file.type === 'text/plain') {
                // Simulate file input change
                const fileInput = document.getElementById('fileInput');
                const dataTransfer = new DataTransfer();
                dataTransfer.items.add(file);
                fileInput.files = dataTransfer.files;
                handleFile({ target: { files: [file] } });
            } else {
                showToast('Please drop a PDF or text file');
            }
        }
    });
    
    // Click to upload
    uploadSection.addEventListener('click', () => {
        document.getElementById('fileInput').click();
    });
    
    // Search on Enter key
    document.getElementById('searchInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            searchContent();
        }
    });
});

</body>
</html>
